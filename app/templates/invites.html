<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Convites • Setting</title>

  <style>
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      margin:0; padding:24px;
      background:#f7fbff; color:#111827;
    }
    .card{
      max-width:980px; margin:0 auto;
      background:#fff; border:1px solid #e5e7eb;
      border-radius:16px; padding:18px;
      box-shadow:0 14px 40px rgba(17,24,39,.08);
    }
    h1{margin:0 0 8px 0}
    .muted{color:#6b7280}
    label{display:block;margin-top:10px;color:#6b7280;font-size:13px}
    input,select{
      width:100%; padding:10px; border:1px solid #e5e7eb;
      border-radius:12px; margin-top:6px;
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .btn{
      margin-top:12px; padding:12px 14px; border:0; border-radius:12px;
      background:#7c3aed; color:#fff; font-weight:700; cursor:pointer;
    }
    .btn:hover{filter:brightness(1.05)}
    .danger{
      margin-top:12px; padding:12px 14px; border:0; border-radius:12px;
      background:#b91c1c; color:#fff; font-weight:700; cursor:pointer;
    }
    .danger:hover{filter:brightness(1.05)}
    .list{margin-top:16px}
    .item{
      padding:12px; border:1px solid #e5e7eb; border-radius:12px;
      margin-top:10px; background:#f8fafc;
      display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap;
    }
    .left{min-width:260px}
    .meta{display:flex; gap:8px; flex-wrap:wrap; margin-top:6px}
    .pill{
      font-size:12px; color:#374151;
      border:1px solid #e5e7eb; background:#fff;
      padding:6px 10px; border-radius:999px;
    }
    code{font-family:ui-monospace,Menlo,Consolas,monospace}
    a{color:#7c3aed; text-decoration:none}
    a:hover{text-decoration:underline}
    .tag-ok{border-color:rgba(6,95,70,.25); background:rgba(6,95,70,.08); color:#065f46}
    .tag-warn{border-color:rgba(180,83,9,.25); background:rgba(180,83,9,.08); color:#92400e}
    .tag-bad{border-color:rgba(185,28,28,.25); background:rgba(185,28,28,.08); color:#b91c1c}
  </style>
</head>

<body>
  <div class="card">
    <h1>Convites</h1>
    <p class="muted">Gere um convite e copie o link para enviar.</p>

    <form method="post" action="/invites/create">
      <label>Papel (role)</label>
      <select name="role">
        <option value="member">member</option>
        <option value="admin">admin</option>
      </select>

      <label>Máximo de usos</label>
      <input name="max_uses" type="number" min="1" value="1" />

      <label>Expira em (dias)</label>
      <input name="expires_days" type="number" min="1" value="7" />

      <button class="btn" type="submit">Gerar convite</button>
    </form>

    <div class="list">
      <h2 style="margin:16px 0 6px 0;font-size:16px;">Convites recentes</h2>

      {% for i in invites %}
        {% set remaining = (i.max_uses - i.uses) if (i.max_uses is not none) else None %}
        {% set expired = (i.expires_at is not none) and (i.expires_at < (cycler.__class__().current)) %}
        <!-- A linha acima é só para evitar erro em Jinja sem "now". Vamos usar status simples abaixo. -->

        <div class="item">
          <div class="left">
            <div><strong>Código:</strong> <code>{{ i.code }}</code></div>
            <div class="muted" style="margin-top:6px;">
              Link: <a href="/signup?code={{ i.code }}">/signup?code={{ i.code }}</a>
            </div>

            <div class="meta">
              <div class="pill">role: <strong>{{ i.role }}</strong></div>
              <div class="pill">usos: <strong>{{ i.uses }}</strong>{% if i.max_uses is not none %}/{{ i.max_uses }}{% endif %}</div>
              {% if i.max_uses is not none %}
                <div class="pill">restantes: <strong>{{ (i.max_uses - i.uses) if (i.max_uses - i.uses) > 0 else 0 }}</strong></div>
              {% endif %}
              {% if i.expires_at %}
                <div class="pill">válido até: <strong>{{ i.expires_at.strftime("%d/%m/%Y") }}</strong></div>
              {% endif %}

              {% if i.revoked %}
                <div class="pill tag-bad"><strong>revogado</strong></div>
              {% elif i.max_uses is not none and i.uses >= i.max_uses %}
                <div class="pill tag-warn"><strong>utilizado</strong></div>
              {% elif i.expires_at %}
                <!-- sem "now" no Jinja padrão, então a expiração real será validada no backend no signup -->
                <div class="pill tag-ok"><strong>ativo</strong></div>
              {% else %}
                <div class="pill tag-ok"><strong>ativo</strong></div>
              {% endif %}
            </div>
          </div>

          <div class="row" style="align-items:flex-start">
            <a class="btn" style="text-align:center; text-decoration:none; display:inline-block;" href="/invites/{{ i.code }}">
              Ver
            </a>

            <form method="post" action="/invites/revoke" onsubmit="return confirm('Revogar este convite?');">
              <input type="hidden" name="invite_id" value="{{ i.id }}">
              <button class="danger" type="submit">Revogar</button>
            </form>
          </div>
        </div>
      {% else %}
        <div class="item">Nenhum convite ainda.</div>
      {% endfor %}
    </div>

    <p class="muted" style="margin-top:14px;"><a href="/">Voltar</a></p>
  </div>
</body>
</html>
